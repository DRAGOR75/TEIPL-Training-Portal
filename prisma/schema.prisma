generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Training Sessions (UPDATED with Dates)
model TrainingSession {
  id                   String   @id @default(uuid())
  programName          String   @map("program_name")
  
  // Trainer Name (Selected from Dropdown in UI)
  trainerName          String?  @map("trainer_name")

  // ðŸŸ¢ NEW: Course Duration & Schedule
  startDate            DateTime @map("start_date")
  endDate              DateTime @map("end_date")
  feedbackCreationDate DateTime? @map("feedback_creation_date") // When to send Level 3 emails

  templateType         String   @default("Technical") @map("template_type")
  emailsSent           Boolean  @default(false) @map("emails_sent")
  createdAt            DateTime @default(now()) @map("created_at")
  
  enrollments          Enrollment[]

  @@map("training_sessions")
}

// 2. Enrollments (Unchanged from your snippet - Includes Level 1 & 3)
model Enrollment {
  id        String @id @default(uuid())
  sessionId String @map("session_id")

  // --- Participant Details ---
  employeeName  String  @map("employee_name")
  employeeEmail String  @map("employee_email")
  managerEmail  String  @map("manager_email")
  
  // Identity Fields for QR Code Form
  empId         String? @map("emp_id")       
  managerName   String? @map("manager_name") 

  status        String  @default("Pending") // Pending, Pending Manager, Completed

  // --- Level 1 Feedback (Immediate / Day 0) ---
  preTrainingRating    Int?    @map("pre_training_rating")
  trainingRating       Int?    @map("training_rating")
  contentRating        Int?    @map("content_rating")
  trainerRating        Int?    @map("trainer_rating")
  materialRating       Int?    @map("material_rating")
  recommendationRating Int?    @map("recommendation_rating")

  topicsLearned        String? @map("topics_learned")
  actionPlan           String? @map("action_plan")
  suggestions          String? @map("suggestions")

  // --- Level 3 Feedback (Post-Training / Day 25) ---
  q1_Relevance         Int?    @map("q1_relevance")
  q2_Application       Int?    @map("q2_application")
  q3_Performance       Int?    @map("q3_performance")
  q4_Influence         Int?    @map("q4_influence")
  q5_Efficiency        Int?    @map("q5_efficiency")
  
  averageRating        Float?  @map("average_rating")

  // --- Manager Review Data ---
  managerAgrees        String? @map("manager_agrees")
  managerComment       String? @map("manager_comment")

  updatedAt            DateTime @default(now()) @map("updated_at")

  session              TrainingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, employeeEmail])
  @@index([sessionId])
  @@map("enrollments")
}

// 3. Nominations (Unchanged)
model Nomination {
  id             String   @id @default(uuid())
  
  // -- Employee Info --
  employeeName   String   @map("employee_name")
  employeeEmail  String   @map("employee_email")
  empId          String   @map("emp_id")
  site           String   
  designation    String   
  mobile         String   
  experience     String   
  
  // -- Nomination Info --
  managerEmail   String   @map("manager_email")
  managerName    String   @map("manager_name")
  programName    String   @default("General Nomination") @map("program_name")
  
  // Justification text
  justification  String   @db.Text 
  
  // Status: Pending, Approved, Rejected
  status         String   @default("Pending")
  
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("nominations")
}

// 4. Trainers (ðŸŸ¢ NEW TABLE)
model Trainer {
  id        String   @id @default(uuid())
  name      String   @unique
  email     String?  
  expertise String?  
  createdAt DateTime @default(now()) @map("created_at")

  @@map("trainers")
}