generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  // The Pooled URL (Fast for your app users)
  url       = env("DATABASE_URL")
  // The Direct URL (Required for migrations to work on Neon)
  directUrl = env("DATABASE_URL_UNPOOLED")
}



// 1. Training Sessions
model TrainingSession {
  id                   String      @id @default(uuid())
  programName          String      @map("program_name")
  trainerName          String?     @map("trainer_name")
  startDate            DateTime    @map("start_date")
  endDate              DateTime    @map("end_date")
  feedbackCreationDate DateTime?   @map("feedback_creation_date")
  templateType         String      @default("Technical") @map("template_type")
  emailsSent           Boolean     @default(false) @map("emails_sent")
  feedbackReminderSent Boolean     @default(false) @map("feedback_reminder_sent")
  sendFeedbackAutomatically Boolean @default(false) @map("send_feedback_automatically")

  createdAt            DateTime    @default(now()) @map("created_at")
  
  enrollments          Enrollment[]

  @@unique([programName, startDate, endDate, trainerName])
  @@map("training_sessions")
}

// 2. Enrollments
model Enrollment {
  id             String @id @default(uuid())
  sessionId      String @map("session_id")
  employeeName   String @map("employee_name")
  employeeEmail  String @map("employee_email")
  managerEmail   String @map("manager_email")
  empId          String? @map("emp_id")        
  managerName    String? @map("manager_name") 
  status         String @default("Pending")

  // --- Feedback (Immediate / Day 0) ---
  preTrainingRating    Int?    @map("pre_training_rating")
  postTrainingRating   Int?    @map("post_training_rating") 
  
  trainingRating       Int?    @map("training_rating")
  contentRating        Int?    @map("content_rating")
  trainerRating        Int?    @map("trainer_rating")
  materialRating       Int?    @map("material_rating")
  recommendationRating Boolean?    @map("recommendation_rating")

  topicsLearned        String? @map("topics_learned")
  actionPlan           String? @map("action_plan")
  suggestions          String? @map("suggestions")

  // --- Post training (30 days) performance feedback (Post-Training / Day 30) ---
  q1_Relevance         Int?    @map("q1_relevance")
  q2_Application       Int?    @map("q2_application")
  q3_Performance       Int?    @map("q3_performance")
  q4_Influence         Int?    @map("q4_influence")
  q5_Efficiency        Int?    @map("q5_efficiency")
  averageRating        Float?  @map("average_rating")

  managerAgrees        String? @map("manager_agrees")
  managerComment       String? @map("manager_comment")
  updatedAt            DateTime @default(now()) @map("updated_at")
  session              TrainingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, employeeEmail])
  @@index([sessionId])
  @@map("enrollments")
}

// 3. Nominations
model Nomination {
  id             String   @id @default(uuid())
  employeeName   String   @map("employee_name")
  employeeEmail  String   @map("employee_email")
  empId          String   @map("emp_id")
  site           String   
  designation    String   
  mobile         String   
  experience     String   
  managerEmail   String   @map("manager_email")
  managerName    String   @map("manager_name")
  programName    String   @default("General Nomination") @map("program_name")
  justification  String   @db.Text 
  status         String   @default("Pending")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("nominations")
}

// 4. Trainers 
model Trainer {
  id        String   @id @default(uuid())
  name      String   @unique
  email     String?  @unique
  phone     String?  
  createdAt DateTime @default(now()) @map("created_at")

  @@map("trainers")
}

// 5. Admin Users 
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Hashed password
  name      String?
  createdAt DateTime @default(now()) @map("created_at")

  @@map("users")
}